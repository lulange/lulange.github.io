<!DOCTYPE html>
<html>
  <head>
    <meta charset = "utf-8">
    <title>Difference</title>
  </head>
  <body style="background-color:black;">
    <audio loop id="background-music">
      <source src="music.m4a" type="audio/mp4">
    </audio>
    <h3 style="color:white">The Difference game</h3>
	<!--This draws the canvas on the webpage -->
    <canvas id="mycanvas"></canvas>
  
	<script>
		document.body.addEventListener("load", playMusic);
		var playMusic = function() {
			document.getElementById("background-music").play();
		};
	</script>
  <!-- Include the processing.js library -->
  <!-- See https://khanacademy.zendesk.com/hc/en-us/articles/202260404-What-parts-of-ProcessingJS-does-Khan-Academy-support- for differences -->
  <script src="https://cdn.jsdelivr.net/processing.js/1.4.8/processing.min.js"></script>
  <script>
  var programCode = function(processingInstance) {
    with (processingInstance) {
      size(400, 400);
      frameRate(60);


      /** variables **/
      // to choose what you are seeing
      var screen = 0;
      // button color for the main button constructer function
      var BC = [0, 200, 200];
      // transparency amount
      var transparencyAmount = 0;
      //  a color variable for correct or incorrect edge buttons
      var correctColor = color(75, 92, 92);
      // array for the buttons
      var buttons = [];
      // array for the edge buttons sides
      var colButtons = [];
      // array for the edge buttons top and bottom
      var rowButtons = [];
      // set size global helper
      var setSize = 4;
      // mode variable for mode choices
      var mode = "normal";
      // start Frame Count for timed version
      var startFC = null;
      // total time used
      var totalTime = null;
      // a score deduction variable
      var scoreDeduct = 0;
      // the actual score variable
      var score = 0;
      // the click counter
      var clickedTimes = 0;
      // a sub section variable for the subsections of the help screen
      var subSect = 0;
      // instructions in an array for better looking and easier to use code
      var instructions = ["Difference is a math game. Here is small working game board.    I will use this smaller board for examples. Mess around with it a little before moving on",

      "Take a look at the first column of blue buttons in the example.It is the one with the numbers 3, 3, 2, 1. If the buttons are filled in they are 'on'. If they are empty they are 'off ' ",

      "If a blue buttons is on then it is being subtracted from two numbers the first is the grey rectangle to its left and the second is the grey rectangle directly above it.",

      "Back to that first column, if All of the buttons in that column are 'on' then 28 (the number that is above all of them) gets subtracted by 9. ",

      "But that doesn't do us any good because the goal of the game is to get the number above the column to equal the number below and to get the number to one side to equal the number across         from it.",

      "To do that turn off the first column's 3's and its 1. then 28 minus the remaining 2 will equal 26, and light up the 28 and 26 squares.",

      "To win the game you must do the same for every column and row, so that all of the grey rectangles light up",

      "A few controls before you go: push any key to pause and click the blue buttons to turn them on and off.",

      "You are hopefully now ready to play the game! Click start to play a new 4 by 4 game.   :)"];



      /** constructers **/
      // the main button
      var Button = function(x, y, width, filled, num, transparencyTimer) {
          this.x = x;
          this.y = y;
          this.width = width;
          this.subtractable = round(random(0, 1));
          this.filled = filled;
          this.num = num || round(random(1, 9));
          this.transparencyTimer = transparencyTimer || 0;
      };

      // draw a button
      Button.prototype.draw = function() {
        // two types of button or states of button filled or not filled
        if(this.filled === true) {
            fill(BC[0], BC[1], BC[2], transparencyAmount - this.transparencyTimer);
        } else {
            noFill();
        }
        stroke(BC[0], BC[1], BC[2], transparencyAmount - this.transparencyTimer);
        // somtimes you need smaller strokes
        if (screen === 10 && this.width < 40) {
            strokeWeight(1.9);
        } else {
          strokeWeight(3);
        }

        ellipse(this.x, this.y, this.width, this.width);
        fill(255, 255, 255, transparencyAmount - this.transparencyTimer);
        if (setSize === 6) {
            textSize(20);
        } else if (setSize === 5) {
            textSize(23);
        } else if (screen === 10){
            textSize(19);
        } else {
            textSize(26);
        }

        if (this.num === "start" || this.num === "help" || this.num === "size" || this.num === "next"){
            textSize(26);
            text(this.num, this.x - 25, this.y + -10, 100, 100);
        } else if (this.num === "options" || this.num === "resume" || this.num === "normal") {
            textSize(26);
            text(this.num, this.x - 41, this.y + 9);
        } else if (this.num === "4 by 4" || this.num === "5 by 5" || this.num === "replay" || this.num === "6 by 6" || this.num === "puzzle" ) {
            textSize(26);
            text(this.num, this.x - 37, this.y + 9);
        } else if (this.num === "quit") {
            textSize(26);
            text(this.num, this.x - 23, this.y + 9);
        } else if (this.num === "back") {
            textSize(26);
            text(this.num, this.x - 28, this.y + -10, 100, 100);
        } else if (this.num === "mode" || this.num === "points" || this.num === "timed") {
            textSize(26);
            text(this.num, this.x - 34, this.y + -10, 100, 100);
        } else  if (setSize === 6) {
            text(this.num, this.x - 5.9, this.y + 8);
        } else if (screen === 10) {
            text(this.num, this.x - 5.0, this.y + 6.5);
        } else {
            text(this.num, this.x - 6, this.y + 9);
        }



      };


      // another way to draw it
      Button.prototype.drawRowAndCol = function() {
        noFill();
        if (screen === 10) {
            strokeWeight(1.9);
        } else {
            strokeWeight(3);
        }
        if (this.filled === true) {
            correctColor = color(0, 200, 200);
        } else {
            correctColor = color(75, 92, 92);
        }

        stroke(correctColor, transparencyAmount);
        rect(this.x - 23, this.y - 23, this.width - 5, this.width - 5, 5);
        fill(255, 255, 255, transparencyAmount);
        if (setSize === 6) {
            textSize(20);
        } else if (setSize === 5) {
            textSize(23);
        } else if (screen === 10) {
            textSize(19);
        } else {
            textSize(26);
        }

        var minusX = 0;
        var plusY = 0;
        if (screen === 10) {
            minusX = 20.2;
            plusY = -3;
        } else if (setSize === 4) {
              minusX = 13.5;
              plusY = 9;
        }else if (setSize === 5) {
            minusX = 18;
            plusY = 4;
        } else if (setSize === 6) {
            minusX = 18.3;
            plusY = 1;
        }

        if (this.num > 9) {
            text(this.num, this.x - minusX, this.y + plusY);
        }else if (screen === 10) {
              text(this.num, this.x - minusX/1.4, this.y + plusY);
        } else {
            text(this.num, this.x - minusX/1.5, this.y + plusY);
        }
      };


      // test to see if mouse is over
      Button.prototype.isUnderMouse = function() {
      return  (dist(this.x, this.y, mouseX, mouseY) < this.width/2);
      };


      // change filled state
      Button.prototype.fillUnfill = function() {
        if (this.filled === true) {
            this.filled = false;
        } else {
            this.filled = true;
        }

        if (mode === "points") {
            scoreDeduct = 0;
            for (var i = 0; i < buttons.length; i++) {
                if (buttons[i].subtractable === 0) {
                    scoreDeduct++;
                }
            }

            clickedTimes++;
            score = 100 + scoreDeduct*2 - clickedTimes*2;
        }
      };


      // a function to check the puzzle
      var check = function() {
      // to subtract some from the original number
      var endGameChecker = 0;
        for (var j = 0; j < setSize; j++) {
            var subtractAmountCol = 0;
            var subtractAmountRow = 0;
            for (var t = 0; t < setSize; t++) {
                if (buttons[t*setSize+j].filled === true) {
                    subtractAmountCol += buttons[t*setSize+j].num;
                }
                if (buttons[j*setSize+t].filled === true) {
                    subtractAmountRow += buttons[j*setSize+t].num;
                }
            }
            if (colButtons[j].num - subtractAmountCol === colButtons[j+setSize].num) {
                colButtons[j].filled = true;
                colButtons[j+setSize].filled = true;
                endGameChecker++;
            } else {
                colButtons[j].filled = false;
                colButtons[j+setSize].filled = false;
            }
            if (rowButtons[j].num - subtractAmountRow === rowButtons[j+setSize].num) {
                rowButtons[j].filled = true;
                rowButtons[j+setSize].filled = true;
                endGameChecker++;

            } else {
                rowButtons[j].filled = false;
                rowButtons[j+setSize].filled = false;
            }
        }

        if (endGameChecker === setSize) {
            screen ++;
            var endFC = frameCount;
        }
      };



      /** object instances not in an array **/
      var button1 = new Button(130, 200, 100, false, "start", 100);
      var button2 = new Button(270, 200, 100, false, "help", 300);
      var button3 = new Button(200, 300, 100, false, "options",  500);
      var circleBackground = new Button(200, 200, 575, true, " ");



      /** array filling **/
      // one big function
      var assignTheSet = function(size, helpScreen) {
        // array for the buttons
        buttons = [];
        // array for the edge buttons sides
        colButtons = [];
        // array for the edge buttons top and bottom
        rowButtons = [];
        // fill the buttons array
        for (var i = 0; i < size; i++) {
            for (var j = 0; j < size; j++) {
                if (size === 4 && helpScreen === true) {
                    buttons.push(new Button(i*37+233, j*37+235, 25, true));
                } else if (size === 4) {
                  buttons.push(new Button(i*66+97, j*66+105, 50, true));
                } else if (size === 5) {
                    buttons.push(new Button(i*55+90, j*55+92, 40, true));
                } else if (size === 6) {
                    buttons.push(new Button(i*45+87, j*45+90, 35, true));
                }
            }
        }


            // fill the colButtons array and the rowButtons array
            for (var i = 0; i < 2; i++) {
                for (var j = 0; j < size; j++) {
                    var tileNumCol = 0;
                    var tileNumRow = 0;
                    var subtractAmountCol = 0;
                    var subtractAmountRow = 0;
                    // simple method
                    if (i < 1) {
                        tileNumCol= round(random(10, 30)); tileNumRow = round(random(10, size*size*2));
                    }
                    // complicated part?!?!?!?
                    if (i > 0) {

                        // to subtract some from the original number
                        for (var t = 0; t < size; t++) {
                            if (buttons[t*size+j].subtractable === 1) {
                                subtractAmountCol += buttons[t*size+j].num;
                            }
                            if (buttons[j*size+t].subtractable === 1) {
                                subtractAmountRow += buttons[j*size+t].num;
                            }
                        }

                        tileNumCol = colButtons[j].num - subtractAmountCol;
                        tileNumRow = rowButtons[j].num - subtractAmountRow;

                        if (tileNumCol <= 0) {
                            colButtons[j].num += round(random(1, size/2*size));
                            j = j - 1;
                            continue;
                        }

                        if (tileNumRow <= 0) {
                            rowButtons[j].num += round(random(1, size/2*size));
                            j = j - 1;
                            continue;
                        }
                    }
                    if (size === 4 && helpScreen === true) {
                        colButtons.push(new Button(i*175+212,j*37+245, 30, false, tileNumCol));
                        rowButtons.push(new Button(j*37+243, i*175+212, 30, false, tileNumRow));
                    } else if (size === 4) {
                          colButtons.push(new Button(i*343+27,j*66+105, 50, false, tileNumCol));
                          rowButtons.push(new Button(j*66+97, i*343+29, 50, false, tileNumRow));
                    } else if (size === 5) {
                        colButtons.push(new Button(i*330+40,j*55+98, 40, false, tileNumCol));
                        rowButtons.push(new Button(j*55+97, i*330+41, 40, false, tileNumRow));
                    } else if (size === 6) {
                       colButtons.push(new Button(i*343+34,j*45+95, 35, false, tileNumCol));
                       rowButtons.push(new Button(j*45+93, i*343+35, 35, false, tileNumRow));
                    }

                }
            }
            // a special instance when you'll want the same board every time
          if (helpScreen === true) {
                  var savedButtons = [3, 3, 2, 1, 3, 4, 3, 2, 7, 3, 7, 5, 2, 9, 4, 6];
                  var savedRow = [28, 15, 27, 30, 26, 12, 19, 24];
                  var savedCol = [24, 25, 21, 13, 19, 22, 15, 8];
              for (var i = 0; i < buttons.length; i++) {
                  buttons[i].num = savedButtons[i];
              }

              for (var i = 0; i < colButtons.length; i++) {
                    colButtons[i].num = savedCol[i];
                    rowButtons[i].num = savedRow[i];
              }
          }
      };



      /** functions **/
      // a function to check the puzzle
      var check = function() {
      // to subtract some from the original number
      var endGameChecker = 0;
        for (var j = 0; j < setSize; j++) {
            var subtractAmountCol = 0;
            var subtractAmountRow = 0;
            for (var t = 0; t < setSize; t++) {
                if (buttons[t*setSize+j].filled === true) {
                    subtractAmountCol += buttons[t*setSize+j].num;
                }
                if (buttons[j*setSize+t].filled === true) {
                    subtractAmountRow += buttons[j*setSize+t].num;
                }
            }
            if (colButtons[j].num - subtractAmountCol === colButtons[j+setSize].num) {
                colButtons[j].filled = true;
                colButtons[j+setSize].filled = true;
                endGameChecker++;
            } else {
                colButtons[j].filled = false;
                colButtons[j+setSize].filled = false;
            }
            if (rowButtons[j].num - subtractAmountRow === rowButtons[j+setSize].num) {
                rowButtons[j].filled = true;
                rowButtons[j+setSize].filled = true;
                endGameChecker++;

            } else {
                rowButtons[j].filled = false;
                rowButtons[j+setSize].filled = false;
            }
        }

        if (endGameChecker === setSize*2 && screen !== 10) {
            screen ++;
            totalTime = round((frameCount - startFC));
            totalTime = round(totalTime/60);
        }
      };


      // a function to set the start game variables for normal play
      var gameSetup = function() {
          /** variable reset **/
          // circle size up
          circleBackground.width = 1000;
          startFC = frameCount;
          // button color for the main button constructer function
          BC = [0, 200, 200];
          //  a color variable for correct or incorrect edge buttons
          correctColor = color(75, 92, 92);
          // assign the set for the puzzle
          assignTheSet(setSize);
          // game screen
          screen = 1;
          // assign the set for the puzzle
          assignTheSet(setSize);
      };

      // a function to draw all the buttons
      var drawTheSet = function(size) {
        for (var loop = 0; loop < buttons.length; loop++) {
            if (buttons[loop].isUnderMouse() === true) {
                BC = [13, 159, 159];
            } else {
                BC = [0, 200, 200];
            }
                buttons[loop].draw();
        }
        check();
        for (var i = 0; i < rowButtons.length; i++) {
            colButtons[i].drawRowAndCol();
            rowButtons[i].drawRowAndCol();
        }
      };

      // a function for the mouseClicked function area here to save code
      var checkAllButtons = function() {
          for (var t = 0; t < setSize*setSize; t++) {
              if (buttons[t].isUnderMouse() === true) {
                  buttons[t].fillUnfill();
              }
          }

      };

      /*****************
      * MAIN PROGRAM
      ******************/


      draw = function () {

        // start screen
        if (screen === 0) {
            button1.num = "start";
            button2.num = "help";
            button3.num = "options";
            BC = [0, 200, 200];
            fill(0, 0, 0);
            if (circleBackground.width < 574) {
                circleBackground.width += 15;
            }

            if (circleBackground.width > 558 && circleBackground.width < 574) {
                transparencyAmount = 0;
            }

            circleBackground.draw();
            if (circleBackground.width > 570) {
                fill(255, 255, 255, transparencyAmount);
                textSize(54);
                text("Difference", 76, 100);
            }

        }

        // game screen
        else if (screen === 1) {
            // to insure no odd transparency problems
            transparencyAmount = 255;
            // draw the buttons
            background(0, 0, 0);
            drawTheSet(setSize);
            // shrink the circle
            if (circleBackground.width > 0) {
                circleBackground.width -= 15;
                circleBackground.draw();
            }
        }

        // end screen
        else if (screen === 2) {
            button1.num = "replay";
            button2.num = "quit";
            button3.num = "help";
            BC = [0, 200, 200];
            if (circleBackground.width < 575) {
                circleBackground.width += 15;

            }

            if (circleBackground.width > 558 && circleBackground.width < 574) {
                transparencyAmount = 0;
            }

            circleBackground.draw();

            if (circleBackground.width > 570) {
                fill(255, 255, 255, transparencyAmount);
                textSize(54);
                text("Good Game!", 47, 100);
                if (mode === "timed") {
                    textSize(26);
                    text("your time is " + totalTime + " seconds", 71, 135);
                }
                if (mode === "points") {
                    textSize(26);
                    text("your score was " + score, 84, 135);
                }

            }

            if (button1.isUnderMouse() === true) {
                BC = [13, 159, 159];
            } else {
                BC = [255, 255, 255];
            }
        }

        // options screen
        else if (screen === 3) {
            button1.num = "back";
            button2.num = "size";
            button3.num = "mode";
            BC = [0, 200, 200];
            fill(0, 0, 0);
            circleBackground.draw();
            fill(255, 255, 255, transparencyAmount);
            textSize(54);
            text("options", 105, 100);
        }

        // puzzle size changing screen
        else if (screen === 4) {
            button1.num = "4 by 4";
            button2.num = "5 by 5";
            button3.num = "6 by 6";
            BC = [0, 200, 200];
            fill(0, 0, 0);
            circleBackground.draw();
            fill(255, 255, 255, transparencyAmount);
            textSize(54);
            text("puzzle size", 56, 100);
        }

        // a pause screen
        else if (screen === 5) {
            button1.num = "resume";
            button2.num = "quit";
            button3.num = "help";
            BC = [0, 200, 200];
            fill(0, 0, 0);
            if (circleBackground.width < 574) {
                circleBackground.width += 15;
            }

            if (circleBackground.width > 558 && circleBackground.width < 574) {
                transparencyAmount = 0;
            }

            circleBackground.draw();
            if (circleBackground.width > 570) {
                fill(255, 255, 255, transparencyAmount);
                textSize(54);
                text("paused", 104, 100);
            }
        }

        // a mode choice screen
        else if (screen === 6) {
            button1.num = "normal";
            button2.num = "timed";
            button3.num = "points";
            BC = [0, 200, 200];
            fill(0, 0, 0);
            circleBackground.draw();
            fill(255, 255, 255, transparencyAmount);
            textSize(54);
            text("mode", 129, 100);
        }

        // the help screen
        else if (screen === 10) {
            // this must happen every time
            button1.num = "back";
            button2.num = "next";
            if (subSect === 8) {
                button2.num = "start";
            }
            // set up
            transparencyAmount += 7;
            stroke(105, 105, 105);
            background(20,200, 200);

              // the board
              fill(0, 0, 0);
              rect(182, 182, 209, 209, 5);
              drawTheSet();

              // for the text
              textSize(19);
              fill(255, 255, 255, transparencyAmount);


              text(instructions[subSect], 14, 18, 207, 400);

        }

        // a draw and check place for the selector buttons
        if (screen !== 1 && circleBackground.width > 570) {

            if (screen === 10) {
                // moving button1
                button1.x = 92;
                button1.y = 305;
                // moving button2
                button2.x = 300;
                button2.y = 100;
            } else {
                // moving button1
                button1.x = 130;
                button1.y = 200;
                // moving button2
                button2.x = 270;
                button2.y = 200;
            }

            transparencyAmount += 7;

            if (button1.isUnderMouse() === true) {
            BC = [13, 159, 159];
        } else {
            BC = [255, 255, 255];
        }
        button1.draw();
        if (button2.isUnderMouse() === true) {
            BC = [13, 159, 159];
        } else {
            BC = [255, 255, 255];
        }
        button2.draw();

        if (screen !== 10) {
            if (button3.isUnderMouse() === true) {
                BC = [13, 159, 159];
            } else {
                BC = [255, 255, 255];
            }
            button3.draw();
            }
        }

      };


      mouseClicked = function() {



        if (screen === 10) {
            if (button1.isUnderMouse()) {
                if (subSect <= 0) {
                    screen = 0;
                } else {
                    subSect--;
                }

                transparencyAmount = 0;

            } else if (button2.isUnderMouse()) {
                if (subSect >= 8) {
                    gameSetup();
                } else {
                    subSect++;
                }

                transparencyAmount = 0;
            } else {
                checkAllButtons();

            }


        }

        else if (screen === 6) {
            if (button1.isUnderMouse()) {
                mode = "normal";
                screen = 3;
                transparencyAmount = 0;
            } else if (button2.isUnderMouse()) {
                mode = "timed";
                screen = 3;
                transparencyAmount = 0;
            } else if (button3.isUnderMouse()) {
                mode = "points";
                screen = 3;
                transparencyAmount = 0;
            }
        }

        else if (screen === 5) {
            if (button1.isUnderMouse()) {
                circleBackground.width = 1000;
                screen = 1;
            }
            if (button2.isUnderMouse()) {
                screen = 0;
                transparencyAmount = 0;
            }
            if (button3.isUnderMouse()) {

                /** variable reset **/

                // transparencyAmount
                transparencyAmount = 0;
                // to make sure you see the right thing
                subSect = 0;
                // setSize to 4 for the help puzzle
                setSize = 4;
                // button color for the main button constructer function
                BC = [0, 200, 200];
                //  a color variable for correct or incorrect edge buttons
                correctColor = color(75, 92, 92);
                // NEW puzzle please
                assignTheSet(4, true);
                // help screen
                screen = 10;

            }
        }

        else if (screen === 4) {
            if (button1.isUnderMouse() && transparencyAmount > 100) {
                setSize = 4;
                screen = 3;
                transparencyAmount = 0;
            } else if (button2.isUnderMouse() && transparencyAmount > 100) {
                setSize = 5;
                screen = 3;
                transparencyAmount = 0;
            } else if (button3.isUnderMouse() && transparencyAmount > 100) {
                setSize = 6;
                screen = 3;
                transparencyAmount = 0;
            }

        }

        else if (screen === 3) {
            if (button1.isUnderMouse()) {
                screen = 0;
                transparencyAmount = 0;
            }
            if (button2.isUnderMouse()) {
                screen = 4;
                transparencyAmount = 0;
            }
            if (button3.isUnderMouse()) {
                screen = 6;
                transparencyAmount = 0;
            }
        }

        else if (screen === 2) {
            if (button1.isUnderMouse()) {
                /** variable reset **/
                startFC = frameCount;
                // button color for the main button constructer function
                BC = [0, 200, 200];
                //  a color variable for correct or incorrect edge buttons
                correctColor = color(75, 92, 92);
                // NEW puzzle please
                assignTheSet(setSize);
                // game screen
                screen = 1;
                // reset the clicked times variable
                clickedTimes = 0;
            }

            if (button2.isUnderMouse()) {
                /** variable reset **/
                // start screen
                screen = 0;
                // transparency
                transparencyAmount = 0;
            }
            if (button3.isUnderMouse()) {

                /** variable reset **/

                // transparencyAmount
                transparencyAmount = 0;
                // to make sure you see the right thing
                subSect = 0;
                // setSize to 4 for the help puzzle
                setSize = 4;
                // button color for the main button constructer function
                BC = [0, 200, 200];
                //  a color variable for correct or incorrect edge buttons
                correctColor = color(75, 92, 92);
                // NEW puzzle please
                assignTheSet(4, true);
                // help screen
                screen = 10;

            }
        }

        else if (screen === 1 && circleBackground.width < 0) {
            checkAllButtons();
        }

        else if (screen === 0) {
            if (button1.isUnderMouse()) {
                gameSetup();
            // help button
            } else if (button2.isUnderMouse()) {

                /** variable reset **/

                // transparencyAmount
                transparencyAmount = 0;
                // to make sure you see the right thing
                subSect = 0;
                // button color for the main button constructer function
                BC = [0, 200, 200];
                // setSize to 4 for the help puzzle
                setSize = 4;
                //  a color variable for correct or incorrect edge buttons
                correctColor = color(75, 92, 92);
                // assign the set of buttons
                assignTheSet(4, true);
                // help screen
                screen = 10;

            // options button
            } else if (button3.isUnderMouse()) {
                screen = 3;
                transparencyAmount = 0;
            }


        }
      };


      keyPressed = function() {
        if(screen === 1) {
            screen = 5;
        }

      };











    }};

  // Get the canvas that ProcessingJS will use
  var canvas = document.getElementById("mycanvas");
  // Pass the function to ProcessingJS constructor
  var processingInstance = new Processing(canvas, programCode);
  </script>
	</body>
</html>
